{% extends 'evaluator/base.html' %} {% block content %}
<div class="mb-5">
  <h2 class="header-title">Evaluation Results</h2>
  <p class="text-muted">
    Job: {{ job.job_title }} | Candidates Ranked: {{ cvs|length }}
  </p>
</div>

<!-- Top Candidate Email Draft -->
{% if email_draft %}
<div class="card shadow-sm mb-5 border-success">
  <div class="card-header bg-success text-white fw-bold">
    ‚úâÔ∏è Draft Email for Top Candidate
  </div>
  <div class="card-body bg-light">
    <pre style="white-space: pre-wrap; font-family: sans-serif">
{{ email_draft }}</pre
    >
  </div>
</div>
{% endif %}

<!-- Rankings -->
<div class="row">
  {% for cv in cvs %}
  <div class="col-12 mb-4">
    <div
      class="card shadow-sm h-100 {% if forloop.first %}border-primary{% endif %}"
    >
      <div
        class="card-header d-flex justify-content-between align-items-center {% if forloop.first %}bg-primary text-white{% endif %}"
      >
        <h5 class="mb-0">#{{ forloop.counter }} {{ cv.candidate_name }}</h5>
        <span class="badge bg-light text-dark fs-6"
          >Score: {{ cv.fit_score }}/100</span
        >
      </div>
      <div class="card-body">
        <p>
          <strong>Email:</strong> {{ cv.candidate_email|default:"Not found" }}
        </p>

        <div class="row">
          <div class="col-md-6">
            <h6 class="text-success">‚úÖ Strengths</h6>
            <ul>
              {% for s in cv.evaluation_json.strengths %}
              <li>{{ s }}</li>
              {% empty %}
              <li>No specific strengths listed.</li>
              {% endfor %}
            </ul>
          </div>
          <div class="col-md-6">
            <h6 class="text-danger">‚ö†Ô∏è Missing / Weaknesses</h6>
            <ul>
              {% for w in cv.evaluation_json.weaknesses %}
              <li>{{ w }}</li>
              {% empty %}
              <li>No specific weaknesses listed.</li>
              {% endfor %}
            </ul>
          </div>
        </div>

        <hr />
        <h6>üìù Summary</h6>
        <p class="text-muted">{{ cv.evaluation_json.summary }}</p>

        <div class="mt-3">
          <a
            href="{{ cv.file.url }}"
            target="_blank"
            class="btn btn-sm btn-outline-secondary"
            >View Original CV</a
          >
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

<div class="text-center mt-5 mb-5">
  <a href="{% url 'job_entry' %}" class="btn btn-secondary"
    >Start New Evaluation</a
  >
</div>
{% endblock %}
